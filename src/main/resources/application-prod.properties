# ==============================================================
# AMBIENTE DE PRODUÇÃO (PROD) - Otimizado para Performance e Segurança
# ==============================================================

# --- CONEXÃO COM O BANCO DE DADOS (MySQL) ---
# Variáveis de ambiente (${...}) são obrigatórias para segurança.
# Adicionado 'serverTimezone=UTC' para evitar erros de data/hora.
spring.datasource.url=jdbc:mysql://${DB_HOST}:3306/${DB_NAME}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# --- POOL DE CONEXÕES (HikariCP) - Ajuste Fino ---
# Mantém 5 conexões sempre abertas para responder rápido às primeiras requisições
spring.datasource.hikari.minimum-idle=5
# Limita a 20 para não estourar a memória do servidor compartilhado (Uhserver)
spring.datasource.hikari.maximum-pool-size=20
# Tempo máximo (30s) que o sistema espera por uma conexão antes de dar erro
spring.datasource.hikari.connection-timeout=30000
# Tempo de vida da conexão (30 min) para renovar conexões e evitar "stale connections"
spring.datasource.hikari.max-lifetime=1800000

# --- JPA / HIBERNATE - Integridade de Dados ---
# CRÍTICO: Em produção usamos 'validate'.
# O 'update' tenta alterar tabelas automaticamente e pode travar o banco em horário comercial.
spring.jpa.hibernate.ddl-auto=validate

# Performance: Não formata nem mostra SQL no console (economiza I/O de disco)
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# --- OTIMIZAÇÃO DE TRANSAÇÕES (Lotes) ---
# CRÍTICO: Desliga o OSIV. Libera a conexão do banco imediatamente após a busca dos dados.
# Evita o erro de "Connection Pool Exhausted" em dias de muito movimento.
spring.jpa.open-in-view=false

# Agrupa inserts/updates (Ex: Salvar uma venda com 50 itens faz 1 ida ao banco, não 50)
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# --- SEGURANÇA DA API ---
# Segredos carregados do ambiente
api.security.token.secret=${JWT_SECRET}
nfe.certificado.senha=${CERT_PASS}

# SEGURANÇA: Desabilita a documentação pública (Swagger) em produção.
# Isso dificulta que atacantes descubram os endpoints da sua API.
springdoc.swagger-ui.enabled=false
springdoc.api-docs.enabled=false

# --- MONITORAMENTO E LOGS ---
# Apenas logs informativos e de erro. Debug desligado.
logging.level.root=INFO
logging.level.org.hibernate=WARN
logging.level.org.springframework=WARN
# Mantém logs da sua aplicação para auditoria
logging.level.br.com.lojaddcosmeticos=INFO