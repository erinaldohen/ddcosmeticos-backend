# ==============================================================
# AMBIENTE DE PRODUCAO (PROD) - Otimizado para Performance e Seguranca
# ==============================================================

# --- CONEXAO COM O BANCO DE DADOS (MySQL) ---
# Variaveis de ambiente (${...}) sao obrigatorias para seguranca.
# Adicionado 'serverTimezone=UTC' para evitar erros de data/hora.
spring.datasource.url=jdbc:mysql://${DB_HOST}:3306/${DB_NAME}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# --- POOL DE CONEXOES (HikariCP) - Ajuste Fino ---
# Mantem 5 conexoes sempre abertas para responder rapido as primeiras requisicoes
spring.datasource.hikari.minimum-idle=5
# Limita a 20 para nao estourar a memoria do servidor compartilhado (Uhserver)
spring.datasource.hikari.maximum-pool-size=20
# Tempo maximo (30s) que o sistema espera por uma conexao antes de dar erro
spring.datasource.hikari.connection-timeout=30000
# Tempo de vida da conexao (30 min) para renovar conexoes e evitar "stale connections"
spring.datasource.hikari.max-lifetime=1800000

# --- JPA / HIBERNATE - Integridade de Dados ---
# CRITICO: Em producao usamos 'validate'.
# O 'update' tenta alterar tabelas automaticamente e pode travar o banco em horario comercial.
spring.jpa.hibernate.ddl-auto=validate

# Performance: Nao formata nem mostra SQL no console (economiza I/O de disco)
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# --- OTIMIZACAO DE TRANSACOES (Lotes) ---
# CRITICO: Desliga o OSIV. Libera a conexao do banco imediatamente apos a busca dos dados.
# Evita o erro de "Connection Pool Exhausted" em dias de muito movimento.
spring.jpa.open-in-view=false

# Agrupa inserts/updates (Ex: Salvar uma venda com 50 itens faz 1 ida ao banco, nao 50)
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# --- SEGURANCA DA API ---
# Segredos carregados do ambiente
api.security.token.secret=${JWT_SECRET}
nfe.certificado.senha=${CERT_PASS}

# SEGURANCA: Desabilita a documentacao publica (Swagger) em producao.
# Isso dificulta que atacantes descubram os endpoints da sua API.
springdoc.swagger-ui.enabled=false
springdoc.api-docs.enabled=false

# --- MONITORAMENTO E LOGS ---
# Apenas logs informativos e de erro. Debug desligado.
logging.level.root=INFO
logging.level.org.hibernate=WARN
logging.level.org.springframework=WARN
# Mantem logs da sua aplicacao para auditoria
logging.level.br.com.lojaddcosmeticos=INFO

# Configura\u00E7\u00F5es NFC-e (Produ\u00E7\u00E3o)
nfe.ambiente=PRODUCAO
nfe.csc=${CSC_PRODUCAO}
nfe.csc-id=1
# URL de Consulta (Exemplo SEFAZ RS ou do seu estado)
nfe.url-consulta=http://www.sefaz.rs.gov.br/NFCE/NFCE-COM.aspx


spring.h2.console.enabled=false
# Expor apenas endpoints seguros de monitoramento
management.endpoints.web.exposure.include=health,info,metrics